## Project 4 Lab Manual - Vulnerability Management

# 0) Goal & Success Criteria
  -  **Outcome**: Stand up a Greenbone/OpenVAS scanner, perform **credentialed** scans of Windows & Linux hosts, triage/report by **CVSS**, track fixes in a **risk register**, and verify remediation with rescans.
  -  **Success looks like**:
      -  Greenbone Community Edition (GVM/OpenVAS) running and feeds synced.
      -  Scans complete for at least 1 Windows and 1 Linux VM.
      -  Findings exported, prioritized, and tracked to closure in a risk register.
      -  Documentation maps to **NIST 800-53 RA-5** (scanning) and **CIS Control 7** (vuln management).

**No cloud. No trials. All on-prem.**

# 1) Topology & Prep
  -  Scanner host (Ubuntu Server 22.04 or Debian 12).
  -  Targets: at least one **Windows 10/11** VM and one **Ubuntu** (or other Linux) VM on your user VLANs
  -  Firewall (OPNsense): Allow scanner → targets:
      -  **Discovery/port scan**: TCP 1–65535, UDP common ports (e.g., 53/123/161/500, etc.).
      -  **Linux credentialed**: TCP 22 (SSH).
      -  **Windows credentialed**: TCP 445 (SMB), 135 (DCOM), 139, dynamic RPC (>1024), or WinRM 5985/5986 if you prefer WinRM-based auth.
  -  **Managed Switch**: No SPAN needed for vuln scanning; ensure L3 reachability.

# 2) Install Greenbone / OpenVAS (Scanner)
*Commands assume Ubuntu 22.04. Debian 12 is very similar.*

  -  Repo & packages
      -  sudo apt update
      -  sudo apt -y install gvm
  -  One-time setup (db, users, feed, services)
      -  sudo gvm-setup
  -  Verify setup and service health
      -  sudo gvm-check-setup

**If all green, enable services**
  -  sudo systemctl enable --now gvmd
  -  sudo systemctl enable --now ospd-openvas
  -  sudo systemctl enable --now gsad
      - ***[Greenbone Security Assistant (web UI)]***

  -  **Access UI**: https://<scanner_ip>:9392
      -  Login with the admin credentials printed during gvm-setup. If you missed them:
          -  sudo gvmd --create-user admin --password 'Strong#Pass123!'

  -  Keep feeds current (daily):
      -  Manually update feed (community NVT/SCAP/CERT)
          -  sudo gvm-feed-update   # (or greenbone-feed-sync on some builds)
  
  -  ***Optional: systemd timer for daily sync***
      -  echo -e "[Unit]\nDescription=GVM Feed Update\n[Service]\nType=oneshot\nExecStart=/usr/bin/sudo /usr/sbin/gvm-feed-update\n[Install]\nWantedBy=multi-user.target" | sudo tee /etc/systemd/system/gvm-feed-update.service
      -  echo -e "[Unit]\nDescription=Daily GVM Feed Update\n[Timer]\nOnCalendar=daily\nPersistent=true\n[Install]\nWantedBy=timers.target" | sudo tee /etc/systemd/system/gvm-feed-update.timer
      -  sudo systemctl enable --now gvm-feed-update.timer

*If gvm-feed-update isn’t present, your package provides greenbone-feed-sync. Use that instead. The exact name varies by distro build - either is fine.*

# 3) Prepare Targets for Credentialed Scans
*Credentialed scans drastically reduce false positives and add patch/config checks.*

  -  3.1 Linux target (Ubuntu)
      -  Create a dedicated, least-priv user with limited sudo:
          -  sudo adduser scanner
          -  sudo usermod -aG sudo scanner
          -  echo "scanner ALL=(ALL) NOPASSWD: /usr/bin/dpkg,/usr/bin/apt,/bin/cat,/usr/bin/rpm,/usr/bin/dnf,/usr/bin/yum"|\\
          &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sudo tee /etc/sudoers.d/scanner

      -  Test SSH from the scanner host:
          -  ssh scanner@<linux_target_ip> "dpkg -l | head -n 5"

  -  3.2 Windows target (Win10/11)
      -  Create a local user (lab only) and enable required services:
          -  **Local admin user** (for full checks in lab):
              -  Settings → Accounts → Other users → Add user → scanner.
              -  Add to **Administrators** group (lab box only).
          -  **Enable WinRM** (optional path, cleanest over 5985/5986):
              -  winrm quickconfig -q
              -  Set-Item -Path WSMan:\localhost\Service\Auth\Basic -Value $true
              -  Set-Item -Path WSMan:\localhost\Service\AllowUnencrypted -Value $true  # lab only
          -  ***OR SMB/WMI path** (common default):*
              -  Enable **File and Printer Sharing** and **WMI** inbound firewall rules.
              -  Ensure **Remote Registry** service is set to Manual/Running (for some checks).
          -  Verify from scanner:
              -  *From Linux scanner, test SMB auth using crackmapexec (optional helper)*
              -  *sudo apt -y install python3-pip && pip install crackmapexec*
              -  *cme smb <win_ip> -u scanner -p 'Strong#Pass123!' --shares*


***Keep lab creds out of git. Rotate after demos. In production you’d use least-priv service accounts and vaults.***

# 4) Create Scan Objects in Greenbone (Web UI)
  -  In **GSA (https://…:9392)**:
      -  Credentials
          -  **New Credential** → SSH for Linux (scanner / password or key).
          -  **New Credential** → SMB or WinRM for Windows (scanner user).
          -  Store with descriptive names (e.g., linux-ssh-scanner, win-smb-scanner).
      -  Targets
          -  **New Target** → Add hosts (single IP or CIDR).
          -  Attach the appropriate credential to the target.
          -  Set **Alive Test** → “Consider Alive” (lab convenience) or use default.
      -  Scan Config
          -  Start with “**Full and fast**” (good balance).
          -  For thorough lab checks, try “**Full and very deep**” later (heavier).
      -  Tasks
          -  **New Task** → Select Scan Config + Target.
          -  Name: Weekly Authenticated Scan – VLAN#.
          -  *(Optional) **Schedule** weekly, e.g., Sun 02:00.*

# 5) Run Scans & Export Reports
  -  Start the **Task** and monitor progress.
  -  On completion, open the **Report**:
      -  Filter: **High (CVSS ≥ 7.0)** first.
      -  Click individual findings → read “**Solution**” and “**Detection**”.
  -  **Export** report as **CSV** and **HTML** (CSV for your risk register; HTML/PDF for attachable evidence).

# 6) Build Your Risk Register (Markdown or CSV)
  -  Create **risk_register.md** (or a CSV/Sheet) in your repo (private):

**Vulnerability Risk Register**

| ID | Asset | Vuln Title | CVE/CWE | CVSS | Severity | Evidence (Report ID) | Recommended Fix | Owner | SLA | Status | Verified (date) |
|----|-------|------------|---------|------|----------|----------------------|-----------------|-------|-----|--------|-----------------|
| 1  | WIN10-TEST (192.168.10.42) | SMB Signing Not Required | N/A | 8.1 | High | RPT-2025-09-001#42 | Enable SMB signing via GPO | Admin | 14d | Open | - |
| 2  | UBUNTU-SRV (192.168.10.21) | OpenSSH Weak Ciphers | N/A | 5.9 | Med | RPT-2025-09-001#17 | Disable arcfour/3des; reload sshd | Linux | 30d | In Progress | - |

  -  Prioritize by:
      -  **CVSS** (High/CRIT first),
      -  **Asset criticality** (DCs, jump hosts, exposed services first),
      -  **Exploitability** (known exploits? internet-exposed?).
  -  Set SLAs (example):
      -  **Critical**: 7 days
      -  **High**: 14 days
      -  **Medium**: 30 days
      -  **Low**: Best effort / 60–90 days

# 7) Remediate & Verify
  -  Apply fixes per vendor guidance (patch, config change, disable weak protocols).
  -  Document **who** did **what** and **when** in the register.
  -  **Rescan** the same targets:
      -  In GSA, **Clone Task** → “Post-Remediation Verification – <asset>”.
      -  Confirm findings are gone or downgraded.
      -  Update **Verified (date)** and set **Status = Closed**.

# 8) Reduce Noise & False Positives
  -  Use **credentialed** scans (already done).
  -  For persistent false positives:
      -  Document business justification in the risk register.
      -  In GSA, use **Overrides** to lower severity for a specific VT/host (with reasoning).
  -  Don’t blanket-suppress: require **evidence** and **review**.

# 9) Reporting (Interview & Audit-Ready)
  -  Keep a /docs folder:

/docs/                                                                                                                                                                                                      
&nbsp;&nbsp;vm_program_overview.md                                                                                                                                                                              
&nbsp;&nbsp;schedule.md                                                                                                                                                                                            
&nbsp;&nbsp;ra5_mapping.md                                                                                                                                                                                    
&nbsp;&nbsp;sample_report_highs.pdf                                                                                                                                                                                
&nbsp;&nbsp;risk_register.md

  -  **vm_program_overview.md** *(outline)*:
        -  Scope & frequency (weekly full, ad-hoc on change).
        -  Credentialed vs uncredentialed rationale.
        -  SLAs and prioritization model.
        -  Roles & responsibilities (Owner, Approver, Implementer).
        -  Tooling: Greenbone CE (OpenVAS), version, feed update cadence.
  -   **5_mapping.md**:
        -  **NIST 800-53 RA-5** (Vuln Scanning): Greenbone tasks + schedules + evidence exports.
        -  **CA-7** (Continuous Monitoring): Weekly scans + dashboard trend.
        -  **CM-8** (Asset Inventory): Use target lists + exported host lists.
        -  **CIS Control 7** (Vulnerability Management): Lifecycle: Discover → Prioritize → Remediate → Verify.

# 10) (Optional) Safe, Reproducible Demo Vulns (Local Only)
  -  Generate clearly fixable findings to showcase the full cycle:
      -  Linux weak SSH ciphers (Medium):
          -  Edit /etc/ssh/sshd_config to include a weak cipher (for demo), reload, scan, then harden per Ciphers/MACs best practice and rescan.
  -  OWASP Juice Shop container (many web issues, local only):
      -  sudo apt -y install docker.io
      -  sudo docker run -d -p 3000:3000 bkimminich/juice-shop


*Scan the host, then “remediate” by moving behind a reverse proxy with WAF rules or restricting access (lab story).*

***Keep demos isolated. Never expose vulnerable services outside your lab.***

# 11) Security Hygiene You’ll Be Graded On
  -  No hardcoded creds in code or repos; lab creds stored in the scanner UI only.
  -  Least privilege where possible; rotate demo passwords.
  -  Change control: Track when you modify scan configs or exemptions; note approvals in the register.
  -  Versioning: Put docs (not secrets) in git; include dates and versions in filenames.

# 12) Acceptance Checklist
 [&nbsp;&nbsp;] Scanner host installed and reachable over :9392.

 [&nbsp;&nbsp;] Feeds up to date; daily timer working.

 [&nbsp;&nbsp;] Credentialed Linux & Windows scans complete.

 [&nbsp;&nbsp;] Reports exported; High/Critical triaged first.

 [&nbsp;&nbsp;] Risk register created, owners & SLAs assigned.

 [&nbsp;&nbsp;] At least one remediation executed and verified by rescan.

 [&nbsp;&nbsp;] RA-5 / CIS Controls mapping documented.
